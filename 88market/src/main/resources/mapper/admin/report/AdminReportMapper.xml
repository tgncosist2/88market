<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//MyBatis Generator//DTD MyBatis 3 Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.sist.admin.DAO.AdminReportDAO">

    <!-- 두 개의 파라미터를 전달하기 위해 Map 사용 -->
<select id="selectAllReport" resultType="kr.co.sist.DTO.ReportDTO" parameterType="map">
    SELECT *
    FROM (
        SELECT ROWNUM rn, A.*
        FROM (
            SELECT * 
            FROM REPORT 
           <where>
              <if test="nsDTO.searchType == 'title' and nsDTO.keyword != null and nsDTO.keyword != ''">
                AND title LIKE '%' || #{nsDTO.keyword} || '%'
              </if>
              <if test="nsDTO.searchType == 'content' and nsDTO.keyword != null and nsDTO.keyword != ''">
                AND content LIKE '%' || #{nsDTO.keyword} || '%'
              </if>
              <if test="nsDTO.searchType == 'name' and nsDTO.keyword != null and nsDTO.keyword != ''">
                AND name LIKE '%' || #{nsDTO.keyword} || '%'
              </if>
            </where>
            ORDER BY input_date DESC
        ) A
        WHERE ROWNUM &lt;= #{pagination.endRow}
    )
    WHERE rn &gt; #{pagination.startRow}
</select>
    
<!-- 전체 개수 조회 쿼리 -->
<select id="selectTotalCount" resultType="int">
    SELECT COUNT(*) FROM REPORT
    <where>
        <if test="nsDTO.searchType == 'title' and nsDTO.keyword != null and nsDTO.keyword != ''">
            AND title LIKE '%' || #{nsDTO.keyword} || '%'
        </if>
        <if test="nsDTO.searchType == 'content' and nsDTO.keyword != null and nsDTO.keyword != ''">
            AND content LIKE '%' || #{nsDTO.keyword} || '%'
        </if>
        <if test="nsDTO.searchType == 'name' and nsDTO.keyword != null and nsDTO.keyword != ''">
            AND name LIKE '%' || #{nsDTO.keyword} || '%'
        </if>
    </where>
</select>    
    
<select id="selectReportByNum" parameterType="int" resultType="kr.co.sist.DTO.ReportDTO">
  SELECT REP_NUM, TITLE, CONTENT, NAME, INPUT_DATE, REPORT_TYPE, SEARCH_TYPE, USER_NUM, PRD_NUM
  FROM REPORT
  WHERE REP_NUM = #{repNum}
</select>   

<delete id="deleteReportByNum" parameterType="int">
	DELETE FROM REPORT WHERE REP_NUM = #{repNum}
</delete> 

</mapper>
