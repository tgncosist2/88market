<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>관리자 - 공지사항</title>
<!-- 관리자 공지사항 CSS -->
<link rel="stylesheet" th:href="@{/css/admin/notice/notice.css}">
<!-- 외부파일(jQuery, Font Awesome, favicon 등) -->
<th:block th:replace="~{components/admin/external :: external}"></th:block>
</head>

<body>
	<!-- 고정 사이드바 -->
	<div th:replace="~{fragments/admin/admin_sidebar :: sidebar}"></div>

	<div class="admin-wrapper">
		<div class="main-content">
			<!-- 헤더 -->
			<header class="main-header">
				<div class="breadcrumbs">
					<span>게시판 관리 &gt;</span> <span class="current-page">공지사항 관리</span>
				</div>
			</header>

			<!-- 메인 컨텐츠 (공지사항 관리) -->
			<main class="container">
				<section class="search-section">
					<!-- 검색 폼 추가 (method="get") -->
					<form id="searchForm" th:action="@{/admin/notice}" method="get">
						<div class="search-box">
							<select class="search-filter" name="searchType">
								<option value="title"
									th:selected="${param.searchType != null and param.searchType[0] == 'title'}">제목
								</option>
								<option value="content"
									th:selected="${param.searchType != null and param.searchType[0] == 'content'}">내용
								</option>
								<option value="name"
									th:selected="${param.searchType != null and param.searchType[0] == 'name'}">작성자
								</option>
							</select> <input type="text" class="search-input" name="keyword"
								th:value="${param.keyword}" placeholder="검색">
							<button type="submit" class="search-button">검색</button>
							<!-- 검색 초기화 버튼 추가 -->
							<button type="button" class="search-button" id="resetSearch">초기화</button>
						</div>
					</form>
				</section>

				<section class="notice-section">
					<table class="notice-table">
						<thead>
							<tr>
								<th><input type="checkbox" class="all-checkbox"></th>
								<th>번호</th>
								<th>제목</th>
								<th>작성자</th>
								<th>작성일</th>
								<th>상태</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="item, i : ${noticeList}" class="table-row">
								<td><input type="checkbox" class="checkbox"
									th:id="'checkbox' + ${i.count}"
									th:data-notice-num="${item.notNum}"></td>
								<td
									th:text="${pagination.totalCount - ((pagination.pageNum - 1) * pagination.pageSize) - (i.count - 1)}">
								</td>
								<td class="notice-title" th:text="${item.title}"
									style="cursor: pointer; text-align: center;"
									th:onclick="|location.href='@{/admin/notice/detail(notNum=${item.notNum})}'|"></td>
								<td th:text="${item.name}"></td>
								<td th:text="${item.inputDate}"></td>
								<td><span class="status-badge status-visible"
									th:text="${item.statusType}"></span></td>
							</tr>
							<tr th:if="${#lists.isEmpty(noticeList)}">
								<td colspan="6" style="text-align: center;">등록된 공지사항이 없습니다.</td>
							</tr>
						</tbody>
					</table>

					<div class="table-footer">
						<div class="table-controls">
							<button class="control-button"
								th:onclick="|location.href='@{/admin/notice/add}'|">등록</button>
							<button class="control-button" id="deleteBtn">삭제</button>
						</div>
						<!-- 페이지네이션 -->
						<div class="pagination" th:if="${pagination.totalPages > 0}">
							<div class="pagination">
								<!-- 이전 페이지 -->
								<a th:if="${pagination.pageNum > 1}"
									th:href="@{/admin/notice(page=${pagination.pageNum - 1}, 
										  searchType=${param.searchType}, 
										  keyword=${param.keyword})}"
									class="prev">&lt;</a> <a th:unless="${pagination.pageNum > 1}"
									class="prev disabled">&lt;</a>

								<!-- 페이지 번호 -->
								<a th:each="i : ${#numbers.sequence(1, pagination.totalPages)}"
									th:href="@{/admin/notice(page=${i}, 
										  searchType=${param.searchType}, 
										  keyword=${param.keyword})}"
									th:text="${i}"
									th:classappend="${i == pagination.pageNum} ? 'active' : ''"></a>

								<!-- 다음 페이지 -->
								<a th:if="${pagination.pageNum < pagination.totalPages}"
									th:href="@{/admin/notice(page=${pagination.pageNum + 1}, 
										  searchType=${param.searchType}, 
										  keyword=${param.keyword})}"
									class="next">&gt;</a> <a
									th:unless="${pagination.pageNum < pagination.totalPages}"
									class="next disabled">&gt;</a>
							</div>
						</div>
						<div class="table-controls-right">
							<button class="control-button" id="hideOff">보이기</button>
							<button class="control-button" id="hideOn">숨기기</button>
						</div>
					</div>
				</section>
			</main>
		</div>
	</div>

	<script>
		$(function () {
			$('#resetSearch').click(function () {
				$('input[name="keyword"]').val('');
				$('#searchForm').submit();
			});

			// 체크박스 전체 선택
			$('.all-checkbox').click(function () {
				if ($('.all-checkbox').is(':checked')) {
					$('.checkbox').prop('checked', true);
				} else {
					$('.checkbox').prop('checked', false);
				}
			});// click

			// 체크박스 선택 삭제
			$('#deleteBtn').click(function () {
				var selectedNums = [];

				// 선택된 체크박스의 notNum 수집
				$('.checkbox:checked').each(function () {
					selectedNums.push($(this).data('notice-num'));
				});

				if (selectedNums.length === 0) {
					alert('삭제할 항목을 선택해주세요.');
					return;
				}

				if (confirm('선택한 [ ' + selectedNums.length + ' ]개 항목을 정말 삭제하시겠습니까?')) {
					axios.post('/admin/notice/delete', {
						notNums: selectedNums
					})
						.then(function (response) {
							alert('삭제되었습니다.');
							location.reload(); // 페이지 새로고침
						})
						.catch(function (error) {
							alert('삭제 중 오류가 발생했습니다.');
							console.error(error);
						});
				}
			});// click
			
			$('#hideOn').click(()=>{
				var selectedNums = [];
				
				// 선택된 체크박스의 notNum 수집
				$('.checkbox:checked').each(function () {
					selectedNums.push($(this).data('notice-num'));
				});

				if (selectedNums.length === 0) {
					alert('숨길 공지사항을 선택해주세요.');
					return;
				}
				
				axios.post('/admin/notice/hideon',{
					notNums : selectedNums
				}).then(res=>{
					alert("수정 완료되었습니다.")
					location.reload();
				}).catch(err=>{
					console.log(err);
				});
				
			});// click
			
			$('#hideOff').click(()=>{
				var selectedNums = [];
				
				// 선택된 체크박스의 notNum 수집
				$('.checkbox:checked').each(function () {
					selectedNums.push($(this).data('notice-num'));
				});

				if (selectedNums.length === 0) {
					alert('보이게 할 공지사항을 선택해주세요.');
					return;
				}
				
				axios.post('/admin/notice/hideoff',{
					notNums : selectedNums
				}).then(res=>{
					alert("수정 완료되었습니다.")
					location.reload();
				}).catch(err=>{
					console.log(err);
				});
				
			});// click

		});
	</script>
</body>

</html>