<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>88마켓 - 구매하기</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
	<link rel="stylesheet" th:href="@{/css/user/buy.css}">
	<th:block th:replace="~{components/user/external :: external}"></th:block>
	<script src="https://cdn.iamport.kr/v1/iamport.js"></script>
</head>

<body>
	<!-- 헤더 -->
	<th:block th:insert="~{components/user/header :: header}"></th:block>

	<div class="container mt-4">
		<div class="row">
			<!-- 메인 컨텐츠 -->
			<div class="col-lg-8">
				<h2 class="mb-4">주문 / 결제</h2>

				<!-- 첫번째 섹션: 상품 정보 -->
				<div class="section-card mb-4">
					<h4 class="section-title">상품 정보</h4>
					<div class="product-info d-flex">
						<img th:src="@{/images/main/img3.png}" alt="상품 이미지" class="product-image">
						<div class="product-details ms-3">
							<h5 class="product-name">레이저 키요 프로 웹캠 풀박</h5>
							<p class="product-price"><strong>100,000원</strong></p>
						</div>
					</div>
				</div>

				<!-- 두번째 섹션: 배송지 정보 (display: none) -->
				<div class="section-card mb-4">
					<div class="section-header">
						<h4 class="section-title">배송지 정보</h4>
						<button type="button" class="btn address-select-btn" onclick="openAddressModal()">
							<i class="fas fa-map-marker-alt me-1"></i>다른 배송지 선택
						</button>
					</div>
					<div class="row mb-3">
						<div class="col-md-6">
							<label class="form-label">받는 사람 성함</label>
							<input type="text" class="form-control" placeholder="성함을 입력하세요">
						</div>
						<div class="col-md-6">
							<label class="form-label">받는 사람 전화번호</label>
							<input type="tel" class="form-control" placeholder="전화번호를 입력하세요">
						</div>
					</div>
					<div class="row mb-3">
						<div class="col-md-4">
							<label class="form-label">우편번호</label>
							<div class="input-group">
								<input type="text" class="form-control" placeholder="우편번호">
							</div>
						</div>
					</div>
					<div class="mb-3">
						<label class="form-label">주소</label>
						<input type="text" class="form-control" placeholder="주소를 입력하세요">
					</div>
					<div class="mb-3">
						<label class="form-label">상세주소</label>
						<input type="text" class="form-control" placeholder="상세주소를 입력하세요">
					</div>
				</div>

				<!-- 세번째 섹션: 결제방법 -->
				<div class="section-card mb-4">
					<h4 class="section-title">결제방법</h4>
					<div class="payment-methods">
						<div class="payment-option" data-method="card">
							<i class="fas fa-credit-card"></i>
							<span>카드결제</span>
						</div>
						<div class="payment-option" data-method="kakao">
							<i class="fas fa-comment"></i>
							<span>카카오페이</span>
						</div>
						<div class="payment-option" data-method="naver">
							<i class="fas fa-n"></i>
							<span>네이버페이</span>
						</div>
						<div class="payment-option" data-method="toss">
							<i class="fas fa-mobile-alt"></i>
							<span>토스페이</span>
						</div>
					</div>
				</div>

				<!-- 네번째 섹션: 팔팔페이 포인트 -->
				<div class="section-card mb-4">
					<h4 class="section-title">팔팔페이</h4>
					<div class="point-section">
						<div class="current-point mb-3">
							<span>보유 포인트: </span>
							<strong>30,000원</strong>
						</div>
						<div class="point-usage">
							<div class="form-check mb-3">
								<input class="form-check-input" type="checkbox" id="usePoint">
								<label class="form-check-label" for="usePoint">
									포인트 사용
								</label>
							</div>
							<div class="input-group">
								<input type="number" class="form-control" id="pointAmount" placeholder="사용할 포인트"
									disabled>
								<span class="input-group-text">원</span>
								<button class="btn btn-outline-secondary" type="button" id="useAllPoint"
									disabled>전액사용</button>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- 오른쪽 사이드바: 결제 정보 -->
			<div class="col-lg-4">
				<div class="payment-summary" id="paymentSummary">
					<div class="summary-card">
						<h5 class="summary-title">최종 결제 금액</h5>
						<div class="price-breakdown">
							<div class="price-item">
								<span>상품 금액</span>
								<span>100,000원</span>
							</div>
							<div class="price-item">
								<span>안전거래 수수료(1%)</span>
								<span>1,000원</span>
							</div>
							<div class="price-item point-discount">
								<span>포인트 사용</span>
								<span class="text-danger">-0원</span>
							</div>
						</div>
						<hr>
						<div class="total-amount">
							<span><strong>총 결제 금액</strong></span>
							<span class="final-price"><strong>100,000원</strong></span>
						</div>
						<button class="btn btn-primary w-100 mt-3 order-btn" onclick="requestPay()">
							<i class="fas fa-credit-card me-2"></i>주문하기
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- 푸터 -->
	<th:block th:insert="~{components/user/footer :: footer}"></th:block>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script>
		$(function () {
			$('.recent-products-aside').hide();
		})
		// 결제방법 선택
		document.querySelectorAll('.payment-option').forEach(option => {
			option.addEventListener('click', function () {
				document.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('selected'));
				this.classList.add('selected');
			});
		});

		// 포인트 사용 체크박스
		document.getElementById('usePoint').addEventListener('change', function () {
			const pointInput = document.getElementById('pointAmount');
			const useAllBtn = document.getElementById('useAllPoint');

			if (this.checked) {
				pointInput.disabled = false;
				useAllBtn.disabled = false;
				pointInput.style.backgroundColor = '#fff';
			} else {
				pointInput.disabled = true;
				useAllBtn.disabled = true;
				pointInput.style.backgroundColor = '#f8f9fa';
				pointInput.value = '';
			}
		});

		// 전액사용 버튼
		document.getElementById('useAllPoint').addEventListener('click', function () {
			document.getElementById('pointAmount').value = '30000';
		});

		function requestPay() {
			IMP.init("imp14397622");
			IMP.request_pay({
				channelKey: "channel-key-bf43e218-5567-4875-96da-3270e1fba054",
				pay_method: "card",
				merchant_uid: "order_" + new Date().getTime(),
				name: "test",
				amount: 100,
			}, function (rsp) {
				if (rsp.success) {
					console.log(rsp);
				} else {
					alert("결제에 실패했습니다: " + rsp.error_msg);
				}
			});
		}
	</script>
</body>

</html>